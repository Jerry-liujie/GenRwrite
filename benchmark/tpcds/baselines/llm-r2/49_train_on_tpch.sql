SELECT * FROM (SELECT * FROM (SELECT 'web' AS channel, item, return_ratio, return_rank, currency_rank FROM (SELECT t2.ws_item_sk AS item, CAST(SUM(CASE WHEN t2.wr_return_quantity IS NOT NULL THEN CAST(t2.wr_return_quantity AS INTEGER) ELSE 0 END) AS DECIMAL(15, 4)) / CAST(SUM(t2.ws_quantity) AS DECIMAL(15, 4)) AS return_ratio, CAST(SUM(CASE WHEN t2.wr_return_amt IS NOT NULL THEN CAST(t2.wr_return_amt AS DECIMAL(19, 0)) ELSE 0 END) AS DECIMAL(15, 4)) / CAST(SUM(t2.ws_net_paid) AS DECIMAL(15, 4)) AS currency_ratio, RANK() OVER (ORDER BY CAST(SUM(CASE WHEN t2.wr_return_quantity IS NOT NULL THEN CAST(t2.wr_return_quantity AS INTEGER) ELSE 0 END) AS DECIMAL(15, 4)) / CAST(SUM(t2.ws_quantity) AS DECIMAL(15, 4))) AS return_rank, RANK() OVER (ORDER BY CAST(SUM(CASE WHEN t2.wr_return_amt IS NOT NULL THEN CAST(t2.wr_return_amt AS DECIMAL(19, 0)) ELSE 0 END) AS DECIMAL(15, 4)) / CAST(SUM(t2.ws_net_paid) AS DECIMAL(15, 4))) AS currency_rank FROM (SELECT t.ws_sold_date_sk, t.ws_sold_time_sk, t.ws_ship_date_sk, t.ws_item_sk, t.ws_bill_customer_sk, t.ws_bill_cdemo_sk, t.ws_bill_hdemo_sk, t.ws_bill_addr_sk, t.ws_ship_customer_sk, t.ws_ship_cdemo_sk, t.ws_ship_hdemo_sk, t.ws_ship_addr_sk, t.ws_web_page_sk, t.ws_web_site_sk, t.ws_ship_mode_sk, t.ws_warehouse_sk, t.ws_promo_sk, t.ws_order_number, t.ws_quantity, t.ws_wholesale_cost, t.ws_list_price, t.ws_sales_price, t.ws_ext_discount_amt, t.ws_ext_sales_price, t.ws_ext_wholesale_cost, t.ws_ext_list_price, t.ws_ext_tax, t.ws_coupon_amt, t.ws_ext_ship_cost, t.ws_net_paid, t.ws_net_paid_inc_tax, t.ws_net_paid_inc_ship, t.ws_net_paid_inc_ship_tax, t.ws_net_profit, CAST(t0.wr_returned_date_sk AS INTEGER) AS wr_returned_date_sk, CAST(t0.wr_returned_time_sk AS INTEGER) AS wr_returned_time_sk, CAST(t0.wr_item_sk AS INTEGER) AS wr_item_sk, CAST(t0.wr_refunded_customer_sk AS INTEGER) AS wr_refunded_customer_sk, CAST(t0.wr_refunded_cdemo_sk AS INTEGER) AS wr_refunded_cdemo_sk, CAST(t0.wr_refunded_hdemo_sk AS INTEGER) AS wr_refunded_hdemo_sk, CAST(t0.wr_refunded_addr_sk AS INTEGER) AS wr_refunded_addr_sk, CAST(t0.wr_returning_customer_sk AS INTEGER) AS wr_returning_customer_sk, CAST(t0.wr_returning_cdemo_sk AS INTEGER) AS wr_returning_cdemo_sk, CAST(t0.wr_returning_hdemo_sk AS INTEGER) AS wr_returning_hdemo_sk, CAST(t0.wr_returning_addr_sk AS INTEGER) AS wr_returning_addr_sk, CAST(t0.wr_web_page_sk AS INTEGER) AS wr_web_page_sk, CAST(t0.wr_reason_sk AS INTEGER) AS wr_reason_sk, CAST(t0.wr_order_number AS INTEGER) AS wr_order_number, CAST(t0.wr_return_quantity AS INTEGER) AS wr_return_quantity, CAST(t0.wr_return_amt AS DECIMAL(19, 0)) AS wr_return_amt, CAST(t0.wr_return_tax AS DECIMAL(19, 0)) AS wr_return_tax, CAST(t0.wr_return_amt_inc_tax AS DECIMAL(19, 0)) AS wr_return_amt_inc_tax, CAST(t0.wr_fee AS DECIMAL(19, 0)) AS wr_fee, CAST(t0.wr_return_ship_cost AS DECIMAL(19, 0)) AS wr_return_ship_cost, CAST(t0.wr_refunded_cash AS DECIMAL(19, 0)) AS wr_refunded_cash, CAST(t0.wr_reversed_charge AS DECIMAL(19, 0)) AS wr_reversed_charge, CAST(t0.wr_account_credit AS DECIMAL(19, 0)) AS wr_account_credit, CAST(t0.wr_net_loss AS DECIMAL(19, 0)) AS wr_net_loss FROM (SELECT * FROM web_sales WHERE ws_net_profit > 1 AND ws_net_paid > 0 AND ws_quantity > 0) AS t, (SELECT * FROM web_returns WHERE wr_return_amt > 10000) AS t0 WHERE t.ws_order_number = t0.wr_order_number AND t.ws_item_sk = t0.wr_item_sk) AS t2, (SELECT * FROM date_dim WHERE d_year = 1998 AND d_moy = 11) AS t3 WHERE t2.ws_sold_date_sk = t3.d_date_sk GROUP BY t2.ws_item_sk) AS t7 WHERE t7.return_rank <= 10 OR t7.currency_rank <= 10 UNION SELECT 'catalog' AS channel, item, return_ratio, return_rank, currency_rank FROM (SELECT t13.cs_item_sk AS item, CAST(SUM(CASE WHEN t13.cr_return_quantity IS NOT NULL THEN CAST(t13.cr_return_quantity AS INTEGER) ELSE 0 END) AS DECIMAL(15, 4)) / CAST(SUM(t13.cs_quantity) AS DECIMAL(15, 4)) AS return_ratio, CAST(SUM(CASE WHEN t13.cr_return_amount IS NOT NULL THEN CAST(t13.cr_return_amount AS DECIMAL(19, 0)) ELSE 0 END) AS DECIMAL(15, 4)) / CAST(SUM(t13.cs_net_paid) AS DECIMAL(15, 4)) AS currency_ratio, RANK() OVER (ORDER BY CAST(SUM(CASE WHEN t13.cr_return_quantity IS NOT NULL THEN CAST(t13.cr_return_quantity AS INTEGER) ELSE 0 END) AS DECIMAL(15, 4)) / CAST(SUM(t13.cs_quantity) AS DECIMAL(15, 4))) AS return_rank, RANK() OVER (ORDER BY CAST(SUM(CASE WHEN t13.cr_return_amount IS NOT NULL THEN CAST(t13.cr_return_amount AS DECIMAL(19, 0)) ELSE 0 END) AS DECIMAL(15, 4)) / CAST(SUM(t13.cs_net_paid) AS DECIMAL(15, 4))) AS currency_rank FROM (SELECT t10.cs_sold_date_sk, t10.cs_sold_time_sk, t10.cs_ship_date_sk, t10.cs_bill_customer_sk, t10.cs_bill_cdemo_sk, t10.cs_bill_hdemo_sk, t10.cs_bill_addr_sk, t10.cs_ship_customer_sk, t10.cs_ship_cdemo_sk, t10.cs_ship_hdemo_sk, t10.cs_ship_addr_sk, t10.cs_call_center_sk, t10.cs_catalog_page_sk, t10.cs_ship_mode_sk, t10.cs_warehouse_sk, t10.cs_item_sk, t10.cs_promo_sk, t10.cs_order_number, t10.cs_quantity, t10.cs_wholesale_cost, t10.cs_list_price, t10.cs_sales_price, t10.cs_ext_discount_amt, t10.cs_ext_sales_price, t10.cs_ext_wholesale_cost, t10.cs_ext_list_price, t10.cs_ext_tax, t10.cs_coupon_amt, t10.cs_ext_ship_cost, t10.cs_net_paid, t10.cs_net_paid_inc_tax, t10.cs_net_paid_inc_ship, t10.cs_net_paid_inc_ship_tax, t10.cs_net_profit, CAST(t11.cr_returned_date_sk AS INTEGER) AS cr_returned_date_sk, CAST(t11.cr_returned_time_sk AS INTEGER) AS cr_returned_time_sk, CAST(t11.cr_item_sk AS INTEGER) AS cr_item_sk, CAST(t11.cr_refunded_customer_sk AS INTEGER) AS cr_refunded_customer_sk, CAST(t11.cr_refunded_cdemo_sk AS INTEGER) AS cr_refunded_cdemo_sk, CAST(t11.cr_refunded_hdemo_sk AS INTEGER) AS cr_refunded_hdemo_sk, CAST(t11.cr_refunded_addr_sk AS INTEGER) AS cr_refunded_addr_sk, CAST(t11.cr_returning_customer_sk AS INTEGER) AS cr_returning_customer_sk, CAST(t11.cr_returning_cdemo_sk AS INTEGER) AS cr_returning_cdemo_sk, CAST(t11.cr_returning_hdemo_sk AS INTEGER) AS cr_returning_hdemo_sk, CAST(t11.cr_returning_addr_sk AS INTEGER) AS cr_returning_addr_sk, CAST(t11.cr_call_center_sk AS INTEGER) AS cr_call_center_sk, CAST(t11.cr_catalog_page_sk AS INTEGER) AS cr_catalog_page_sk, CAST(t11.cr_ship_mode_sk AS INTEGER) AS cr_ship_mode_sk, CAST(t11.cr_warehouse_sk AS INTEGER) AS cr_warehouse_sk, CAST(t11.cr_reason_sk AS INTEGER) AS cr_reason_sk, CAST(t11.cr_order_number AS INTEGER) AS cr_order_number, CAST(t11.cr_return_quantity AS INTEGER) AS cr_return_quantity, CAST(t11.cr_return_amount AS DECIMAL(19, 0)) AS cr_return_amount, CAST(t11.cr_return_tax AS DECIMAL(19, 0)) AS cr_return_tax, CAST(t11.cr_return_amt_inc_tax AS DECIMAL(19, 0)) AS cr_return_amt_inc_tax, CAST(t11.cr_fee AS DECIMAL(19, 0)) AS cr_fee, CAST(t11.cr_return_ship_cost AS DECIMAL(19, 0)) AS cr_return_ship_cost, CAST(t11.cr_refunded_cash AS DECIMAL(19, 0)) AS cr_refunded_cash, CAST(t11.cr_reversed_charge AS DECIMAL(19, 0)) AS cr_reversed_charge, CAST(t11.cr_store_credit AS DECIMAL(19, 0)) AS cr_store_credit, CAST(t11.cr_net_loss AS DECIMAL(19, 0)) AS cr_net_loss FROM (SELECT * FROM catalog_sales WHERE cs_net_profit > 1 AND cs_net_paid > 0 AND cs_quantity > 0) AS t10, (SELECT * FROM catalog_returns WHERE cr_return_amount > 10000) AS t11 WHERE t10.cs_order_number = t11.cr_order_number AND t10.cs_item_sk = t11.cr_item_sk) AS t13, (SELECT * FROM date_dim WHERE d_year = 1998 AND d_moy = 11) AS t14 WHERE t13.cs_sold_date_sk = t14.d_date_sk GROUP BY t13.cs_item_sk) AS t18 WHERE t18.return_rank <= 10 OR t18.currency_rank <= 10) AS t UNION SELECT 'store' AS channel, item, return_ratio, return_rank, currency_rank FROM (SELECT t25.ss_item_sk AS item, CAST(SUM(CASE WHEN t25.sr_return_quantity IS NOT NULL THEN CAST(t25.sr_return_quantity AS INTEGER) ELSE 0 END) AS DECIMAL(15, 4)) / CAST(SUM(t25.ss_quantity) AS DECIMAL(15, 4)) AS return_ratio, CAST(SUM(CASE WHEN t25.sr_return_amt IS NOT NULL THEN CAST(t25.sr_return_amt AS DECIMAL(19, 0)) ELSE 0 END) AS DECIMAL(15, 4)) / CAST(SUM(t25.ss_net_paid) AS DECIMAL(15, 4)) AS currency_ratio, RANK() OVER (ORDER BY CAST(SUM(CASE WHEN t25.sr_return_quantity IS NOT NULL THEN CAST(t25.sr_return_quantity AS INTEGER) ELSE 0 END) AS DECIMAL(15, 4)) / CAST(SUM(t25.ss_quantity) AS DECIMAL(15, 4))) AS return_rank, RANK() OVER (ORDER BY CAST(SUM(CASE WHEN t25.sr_return_amt IS NOT NULL THEN CAST(t25.sr_return_amt AS DECIMAL(19, 0)) ELSE 0 END) AS DECIMAL(15, 4)) / CAST(SUM(t25.ss_net_paid) AS DECIMAL(15, 4))) AS currency_rank FROM (SELECT t22.ss_sold_date_sk, t22.ss_sold_time_sk, t22.ss_item_sk, t22.ss_customer_sk, t22.ss_cdemo_sk, t22.ss_hdemo_sk, t22.ss_addr_sk, t22.ss_store_sk, t22.ss_promo_sk, t22.ss_ticket_number, t22.ss_quantity, t22.ss_wholesale_cost, t22.ss_list_price, t22.ss_sales_price, t22.ss_ext_discount_amt, t22.ss_ext_sales_price, t22.ss_ext_wholesale_cost, t22.ss_ext_list_price, t22.ss_ext_tax, t22.ss_coupon_amt, t22.ss_net_paid, t22.ss_net_paid_inc_tax, t22.ss_net_profit, CAST(t23.sr_returned_date_sk AS INTEGER) AS sr_returned_date_sk, CAST(t23.sr_return_time_sk AS INTEGER) AS sr_return_time_sk, CAST(t23.sr_item_sk AS INTEGER) AS sr_item_sk, CAST(t23.sr_customer_sk AS INTEGER) AS sr_customer_sk, CAST(t23.sr_cdemo_sk AS INTEGER) AS sr_cdemo_sk, CAST(t23.sr_hdemo_sk AS INTEGER) AS sr_hdemo_sk, CAST(t23.sr_addr_sk AS INTEGER) AS sr_addr_sk, CAST(t23.sr_store_sk AS INTEGER) AS sr_store_sk, CAST(t23.sr_reason_sk AS INTEGER) AS sr_reason_sk, CAST(t23.sr_ticket_number AS INTEGER) AS sr_ticket_number, CAST(t23.sr_return_quantity AS INTEGER) AS sr_return_quantity, CAST(t23.sr_return_amt AS DECIMAL(19, 0)) AS sr_return_amt, CAST(t23.sr_return_tax AS DECIMAL(19, 0)) AS sr_return_tax, CAST(t23.sr_return_amt_inc_tax AS DECIMAL(19, 0)) AS sr_return_amt_inc_tax, CAST(t23.sr_fee AS DECIMAL(19, 0)) AS sr_fee, CAST(t23.sr_return_ship_cost AS DECIMAL(19, 0)) AS sr_return_ship_cost, CAST(t23.sr_refunded_cash AS DECIMAL(19, 0)) AS sr_refunded_cash, CAST(t23.sr_reversed_charge AS DECIMAL(19, 0)) AS sr_reversed_charge, CAST(t23.sr_store_credit AS DECIMAL(19, 0)) AS sr_store_credit, CAST(t23.sr_net_loss AS DECIMAL(19, 0)) AS sr_net_loss FROM (SELECT * FROM store_sales WHERE ss_net_profit > 1 AND ss_net_paid > 0 AND ss_quantity > 0) AS t22, (SELECT * FROM store_returns WHERE sr_return_amt > 10000) AS t23 WHERE t22.ss_ticket_number = t23.sr_ticket_number AND t22.ss_item_sk = t23.sr_item_sk) AS t25, (SELECT * FROM date_dim WHERE d_year = 1998 AND d_moy = 11) AS t26 WHERE t25.ss_sold_date_sk = t26.d_date_sk GROUP BY t25.ss_item_sk) AS t30 WHERE t30.return_rank <= 10 OR t30.currency_rank <= 10) AS t ORDER BY channel, return_rank, currency_rank, item LIMIT 100
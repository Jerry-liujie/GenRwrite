SELECT t14.customer_id, t14.customer_first_name, t14.customer_last_name, t14.customer_email_address FROM (SELECT * FROM (SELECT customer.c_customer_id AS customer_id, customer.c_first_name AS customer_first_name, customer.c_last_name AS customer_last_name, customer.c_preferred_cust_flag AS customer_preferred_cust_flag, customer.c_birth_country AS customer_birth_country, customer.c_login AS customer_login, customer.c_email_address AS customer_email_address, date_dim.d_year AS dyear, SUM(store_sales.ss_ext_list_price - store_sales.ss_ext_discount_amt) AS year_total, 's' AS sale_type FROM customer INNER JOIN store_sales ON customer.c_customer_sk = store_sales.ss_customer_sk INNER JOIN date_dim ON store_sales.ss_sold_date_sk = date_dim.d_date_sk GROUP BY customer.c_customer_id, customer.c_first_name, customer.c_last_name, customer.c_preferred_cust_flag, customer.c_birth_country, customer.c_login, customer.c_email_address, date_dim.d_year UNION ALL SELECT customer0.c_customer_id AS customer_id, customer0.c_first_name AS customer_first_name, customer0.c_last_name AS customer_last_name, customer0.c_preferred_cust_flag AS customer_preferred_cust_flag, customer0.c_birth_country AS customer_birth_country, customer0.c_login AS customer_login, customer0.c_email_address AS customer_email_address, date_dim0.d_year AS dyear, SUM(web_sales.ws_ext_list_price - web_sales.ws_ext_discount_amt) AS year_total, 'w' AS sale_type FROM customer AS customer0 INNER JOIN web_sales ON customer0.c_customer_sk = web_sales.ws_bill_customer_sk INNER JOIN date_dim AS date_dim0 ON web_sales.ws_sold_date_sk = date_dim0.d_date_sk GROUP BY customer0.c_customer_id, customer0.c_first_name, customer0.c_last_name, customer0.c_preferred_cust_flag, customer0.c_birth_country, customer0.c_login, customer0.c_email_address, date_dim0.d_year) AS t5 WHERE sale_type = 's' AND dyear = 1998 AND year_total > 0) AS t6 INNER JOIN (SELECT * FROM (SELECT customer1.c_customer_id AS customer_id, customer1.c_first_name AS customer_first_name, customer1.c_last_name AS customer_last_name, customer1.c_preferred_cust_flag AS customer_preferred_cust_flag, customer1.c_birth_country AS customer_birth_country, customer1.c_login AS customer_login, customer1.c_email_address AS customer_email_address, date_dim1.d_year AS dyear, SUM(store_sales0.ss_ext_list_price - store_sales0.ss_ext_discount_amt) AS year_total, 's' AS sale_type FROM customer AS customer1 INNER JOIN store_sales AS store_sales0 ON customer1.c_customer_sk = store_sales0.ss_customer_sk INNER JOIN date_dim AS date_dim1 ON store_sales0.ss_sold_date_sk = date_dim1.d_date_sk GROUP BY customer1.c_customer_id, customer1.c_first_name, customer1.c_last_name, customer1.c_preferred_cust_flag, customer1.c_birth_country, customer1.c_login, customer1.c_email_address, date_dim1.d_year UNION ALL SELECT customer2.c_customer_id AS customer_id, customer2.c_first_name AS customer_first_name, customer2.c_last_name AS customer_last_name, customer2.c_preferred_cust_flag AS customer_preferred_cust_flag, customer2.c_birth_country AS customer_birth_country, customer2.c_login AS customer_login, customer2.c_email_address AS customer_email_address, date_dim2.d_year AS dyear, SUM(web_sales0.ws_ext_list_price - web_sales0.ws_ext_discount_amt) AS year_total, 'w' AS sale_type FROM customer AS customer2 INNER JOIN web_sales AS web_sales0 ON customer2.c_customer_sk = web_sales0.ws_bill_customer_sk INNER JOIN date_dim AS date_dim2 ON web_sales0.ws_sold_date_sk = date_dim2.d_date_sk GROUP BY customer2.c_customer_id, customer2.c_first_name, customer2.c_last_name, customer2.c_preferred_cust_flag, customer2.c_birth_country, customer2.c_login, customer2.c_email_address, date_dim2.d_year) AS t13 WHERE sale_type = 's' AND dyear = 1998 + 1) AS t14 ON t6.customer_id = t14.customer_id INNER JOIN (SELECT * FROM (SELECT customer3.c_customer_id AS customer_id, customer3.c_first_name AS customer_first_name, customer3.c_last_name AS customer_last_name, customer3.c_preferred_cust_flag AS customer_preferred_cust_flag, customer3.c_birth_country AS customer_birth_country, customer3.c_login AS customer_login, customer3.c_email_address AS customer_email_address, date_dim3.d_year AS dyear, SUM(store_sales1.ss_ext_list_price - store_sales1.ss_ext_discount_amt) AS year_total, 's' AS sale_type FROM customer AS customer3 INNER JOIN store_sales AS store_sales1 ON customer3.c_customer_sk = store_sales1.ss_customer_sk INNER JOIN date_dim AS date_dim3 ON store_sales1.ss_sold_date_sk = date_dim3.d_date_sk GROUP BY customer3.c_customer_id, customer3.c_first_name, customer3.c_last_name, customer3.c_preferred_cust_flag, customer3.c_birth_country, customer3.c_login, customer3.c_email_address, date_dim3.d_year UNION ALL SELECT customer4.c_customer_id AS customer_id, customer4.c_first_name AS customer_first_name, customer4.c_last_name AS customer_last_name, customer4.c_preferred_cust_flag AS customer_preferred_cust_flag, customer4.c_birth_country AS customer_birth_country, customer4.c_login AS customer_login, customer4.c_email_address AS customer_email_address, date_dim4.d_year AS dyear, SUM(web_sales1.ws_ext_list_price - web_sales1.ws_ext_discount_amt) AS year_total, 'w' AS sale_type FROM customer AS customer4 INNER JOIN web_sales AS web_sales1 ON customer4.c_customer_sk = web_sales1.ws_bill_customer_sk INNER JOIN date_dim AS date_dim4 ON web_sales1.ws_sold_date_sk = date_dim4.d_date_sk GROUP BY customer4.c_customer_id, customer4.c_first_name, customer4.c_last_name, customer4.c_preferred_cust_flag, customer4.c_birth_country, customer4.c_login, customer4.c_email_address, date_dim4.d_year) AS t21 WHERE sale_type = 'w' AND dyear = 1998 AND year_total > 0) AS t22 ON t6.customer_id = t22.customer_id INNER JOIN (SELECT * FROM (SELECT customer5.c_customer_id AS customer_id, customer5.c_first_name AS customer_first_name, customer5.c_last_name AS customer_last_name, customer5.c_preferred_cust_flag AS customer_preferred_cust_flag, customer5.c_birth_country AS customer_birth_country, customer5.c_login AS customer_login, customer5.c_email_address AS customer_email_address, date_dim5.d_year AS dyear, SUM(store_sales2.ss_ext_list_price - store_sales2.ss_ext_discount_amt) AS year_total, 's' AS sale_type FROM customer AS customer5 INNER JOIN store_sales AS store_sales2 ON customer5.c_customer_sk = store_sales2.ss_customer_sk INNER JOIN date_dim AS date_dim5 ON store_sales2.ss_sold_date_sk = date_dim5.d_date_sk GROUP BY customer5.c_customer_id, customer5.c_first_name, customer5.c_last_name, customer5.c_preferred_cust_flag, customer5.c_birth_country, customer5.c_login, customer5.c_email_address, date_dim5.d_year UNION ALL SELECT customer6.c_customer_id AS customer_id, customer6.c_first_name AS customer_first_name, customer6.c_last_name AS customer_last_name, customer6.c_preferred_cust_flag AS customer_preferred_cust_flag, customer6.c_birth_country AS customer_birth_country, customer6.c_login AS customer_login, customer6.c_email_address AS customer_email_address, date_dim6.d_year AS dyear, SUM(web_sales2.ws_ext_list_price - web_sales2.ws_ext_discount_amt) AS year_total, 'w' AS sale_type FROM customer AS customer6 INNER JOIN web_sales AS web_sales2 ON customer6.c_customer_sk = web_sales2.ws_bill_customer_sk INNER JOIN date_dim AS date_dim6 ON web_sales2.ws_sold_date_sk = date_dim6.d_date_sk GROUP BY customer6.c_customer_id, customer6.c_first_name, customer6.c_last_name, customer6.c_preferred_cust_flag, customer6.c_birth_country, customer6.c_login, customer6.c_email_address, date_dim6.d_year) AS t29 WHERE sale_type = 'w' AND dyear = 1998 + 1) AS t30 ON t6.customer_id = t30.customer_id AND CASE WHEN t22.year_total > 0 THEN t30.year_total / t22.year_total ELSE 0.0 END > CASE WHEN t6.year_total > 0 THEN t14.year_total / t6.year_total ELSE 0.0 END ORDER BY t14.customer_id, t14.customer_first_name, t14.customer_last_name, t14.customer_email_address LIMIT 100
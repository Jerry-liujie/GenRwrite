SELECT warehouse.w_state, item.i_item_id, SUM(CASE WHEN date_dim.d_date < DATE '2001-05-02' THEN catalog_sales.cs_sales_price - CASE WHEN catalog_returns.cr_refunded_cash IS NOT NULL THEN CAST(catalog_returns.cr_refunded_cash AS DECIMAL(19, 0)) ELSE 0 END ELSE 0 END) AS sales_before, SUM(CASE WHEN date_dim.d_date >= DATE '2001-05-02' THEN catalog_sales.cs_sales_price - CASE WHEN catalog_returns.cr_refunded_cash IS NOT NULL THEN CAST(catalog_returns.cr_refunded_cash AS DECIMAL(19, 0)) ELSE 0 END ELSE 0 END) AS sales_after FROM catalog_sales LEFT JOIN catalog_returns ON catalog_sales.cs_order_number = catalog_returns.cr_order_number AND catalog_sales.cs_item_sk = catalog_returns.cr_item_sk CROSS JOIN warehouse CROSS JOIN item CROSS JOIN date_dim WHERE item.i_current_price >= 0.99 AND (item.i_current_price <= 1.49 AND item.i_item_sk = catalog_sales.cs_item_sk) AND (catalog_sales.cs_warehouse_sk = warehouse.w_warehouse_sk AND catalog_sales.cs_sold_date_sk = date_dim.d_date_sk AND (date_dim.d_date >= (CAST('2001-05-02' AS DATE) - INTERVAL '30' DAY) AND date_dim.d_date <= (CAST('2001-05-02' AS DATE) + INTERVAL '30' DAY))) GROUP BY warehouse.w_state, item.i_item_id ORDER BY warehouse.w_state, item.i_item_id LIMIT 100
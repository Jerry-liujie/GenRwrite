SELECT * FROM (SELECT t1.i_category, t1.i_class, t1.i_brand, t1.i_product_name, t1.d_year, t1.d_qoy, t1.d_moy, t1.s_store_id, t1.sumsales, RANK() OVER (PARTITION BY t1.i_category ORDER BY t1.sumsales DESC) AS rk FROM (SELECT item.i_category, item.i_class, item.i_brand, item.i_product_name, date_dim.d_year, date_dim.d_qoy, date_dim.d_moy, store.s_store_id, SUM(store_sales.ss_sales_price * store_sales.ss_quantity) AS sumsales FROM store_sales, date_dim, store, item WHERE store_sales.ss_sold_date_sk = date_dim.d_date_sk AND store_sales.ss_item_sk = item.i_item_sk AND store_sales.ss_store_sk = store.s_store_sk AND date_dim.d_month_seq >= 1217 AND date_dim.d_month_seq <= 1217 + 11 GROUP BY ROLLUP(item.i_category, item.i_class, item.i_brand, item.i_product_name, date_dim.d_year, date_dim.d_qoy, date_dim.d_moy, store.s_store_id)) AS t1) AS t2 WHERE rk <= 100 ORDER BY i_category, i_class, i_brand, i_product_name, d_year, d_qoy, d_moy, s_store_id, sumsales, rk LIMIT 100
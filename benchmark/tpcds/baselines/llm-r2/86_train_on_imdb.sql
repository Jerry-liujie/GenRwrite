SELECT t1.total_sum, t1.i_category, t1.i_class, t1.f3 + t1.f4 AS lochierarchy, RANK() OVER (PARTITION BY t1.f3 + t1.f4, CASE WHEN t1.f4 = 0 THEN t1.i_category ELSE NULL END ORDER BY t1.total_sum DESC) AS rank_within_parent FROM (SELECT item.i_category, item.i_class, SUM(web_sales.ws_net_paid) AS total_sum, GROUPING(item.i_category) AS f3, GROUPING(item.i_class) AS f4 FROM web_sales, date_dim, item WHERE date_dim.d_month_seq >= 1186 AND date_dim.d_month_seq <= 1186 + 11 AND date_dim.d_date_sk = web_sales.ws_sold_date_sk AND item.i_item_sk = web_sales.ws_item_sk GROUP BY ROLLUP(item.i_class, item.i_category)) AS t1 ORDER BY t1.f3 + t1.f4 DESC, CASE WHEN t1.f3 + t1.f4 = 0 THEN t1.i_category ELSE NULL END, RANK() OVER (PARTITION BY t1.f3 + t1.f4, CASE WHEN t1.f4 = 0 THEN t1.i_category ELSE NULL END ORDER BY t1.total_sum DESC) LIMIT 100
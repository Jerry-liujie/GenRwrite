SELECT t20.customer_id, t20.customer_first_name, t20.customer_last_name, t20.customer_birth_country FROM (SELECT * FROM (SELECT customer.c_customer_id AS customer_id, customer.c_first_name AS customer_first_name, customer.c_last_name AS customer_last_name, customer.c_preferred_cust_flag AS customer_preferred_cust_flag, customer.c_birth_country AS customer_birth_country, customer.c_login AS customer_login, customer.c_email_address AS customer_email_address, date_dim.d_year AS dyear, SUM((store_sales.ss_ext_list_price - store_sales.ss_ext_wholesale_cost - store_sales.ss_ext_discount_amt + store_sales.ss_ext_sales_price) / 2) AS year_total, 's' AS sale_type FROM customer INNER JOIN store_sales ON customer.c_customer_sk = store_sales.ss_customer_sk INNER JOIN date_dim ON store_sales.ss_sold_date_sk = date_dim.d_date_sk GROUP BY customer.c_customer_id, customer.c_first_name, customer.c_last_name, customer.c_preferred_cust_flag, customer.c_birth_country, customer.c_login, customer.c_email_address, date_dim.d_year UNION ALL SELECT customer0.c_customer_id AS customer_id, customer0.c_first_name AS customer_first_name, customer0.c_last_name AS customer_last_name, customer0.c_preferred_cust_flag AS customer_preferred_cust_flag, customer0.c_birth_country AS customer_birth_country, customer0.c_login AS customer_login, customer0.c_email_address AS customer_email_address, date_dim0.d_year AS dyear, SUM((catalog_sales.cs_ext_list_price - catalog_sales.cs_ext_wholesale_cost - catalog_sales.cs_ext_discount_amt + catalog_sales.cs_ext_sales_price) / 2) AS year_total, 'c' AS sale_type FROM customer AS customer0 INNER JOIN catalog_sales ON customer0.c_customer_sk = catalog_sales.cs_bill_customer_sk INNER JOIN date_dim AS date_dim0 ON catalog_sales.cs_sold_date_sk = date_dim0.d_date_sk GROUP BY customer0.c_customer_id, customer0.c_first_name, customer0.c_last_name, customer0.c_preferred_cust_flag, customer0.c_birth_country, customer0.c_login, customer0.c_email_address, date_dim0.d_year UNION ALL SELECT customer1.c_customer_id AS customer_id, customer1.c_first_name AS customer_first_name, customer1.c_last_name AS customer_last_name, customer1.c_preferred_cust_flag AS customer_preferred_cust_flag, customer1.c_birth_country AS customer_birth_country, customer1.c_login AS customer_login, customer1.c_email_address AS customer_email_address, date_dim1.d_year AS dyear, SUM((web_sales.ws_ext_list_price - web_sales.ws_ext_wholesale_cost - web_sales.ws_ext_discount_amt + web_sales.ws_ext_sales_price) / 2) AS year_total, 'w' AS sale_type FROM customer AS customer1 INNER JOIN web_sales ON customer1.c_customer_sk = web_sales.ws_bill_customer_sk INNER JOIN date_dim AS date_dim1 ON web_sales.ws_sold_date_sk = date_dim1.d_date_sk GROUP BY customer1.c_customer_id, customer1.c_first_name, customer1.c_last_name, customer1.c_preferred_cust_flag, customer1.c_birth_country, customer1.c_login, customer1.c_email_address, date_dim1.d_year) AS t8 WHERE sale_type = 's' AND dyear = 1999 AND year_total > 0) AS t9 INNER JOIN (SELECT * FROM (SELECT customer2.c_customer_id AS customer_id, customer2.c_first_name AS customer_first_name, customer2.c_last_name AS customer_last_name, customer2.c_preferred_cust_flag AS customer_preferred_cust_flag, customer2.c_birth_country AS customer_birth_country, customer2.c_login AS customer_login, customer2.c_email_address AS customer_email_address, date_dim2.d_year AS dyear, SUM((store_sales0.ss_ext_list_price - store_sales0.ss_ext_wholesale_cost - store_sales0.ss_ext_discount_amt + store_sales0.ss_ext_sales_price) / 2) AS year_total, 's' AS sale_type FROM customer AS customer2 INNER JOIN store_sales AS store_sales0 ON customer2.c_customer_sk = store_sales0.ss_customer_sk INNER JOIN date_dim AS date_dim2 ON store_sales0.ss_sold_date_sk = date_dim2.d_date_sk GROUP BY customer2.c_customer_id, customer2.c_first_name, customer2.c_last_name, customer2.c_preferred_cust_flag, customer2.c_birth_country, customer2.c_login, customer2.c_email_address, date_dim2.d_year UNION ALL SELECT customer3.c_customer_id AS customer_id, customer3.c_first_name AS customer_first_name, customer3.c_last_name AS customer_last_name, customer3.c_preferred_cust_flag AS customer_preferred_cust_flag, customer3.c_birth_country AS customer_birth_country, customer3.c_login AS customer_login, customer3.c_email_address AS customer_email_address, date_dim3.d_year AS dyear, SUM((catalog_sales0.cs_ext_list_price - catalog_sales0.cs_ext_wholesale_cost - catalog_sales0.cs_ext_discount_amt + catalog_sales0.cs_ext_sales_price) / 2) AS year_total, 'c' AS sale_type FROM customer AS customer3 INNER JOIN catalog_sales AS catalog_sales0 ON customer3.c_customer_sk = catalog_sales0.cs_bill_customer_sk INNER JOIN date_dim AS date_dim3 ON catalog_sales0.cs_sold_date_sk = date_dim3.d_date_sk GROUP BY customer3.c_customer_id, customer3.c_first_name, customer3.c_last_name, customer3.c_preferred_cust_flag, customer3.c_birth_country, customer3.c_login, customer3.c_email_address, date_dim3.d_year UNION ALL SELECT customer4.c_customer_id AS customer_id, customer4.c_first_name AS customer_first_name, customer4.c_last_name AS customer_last_name, customer4.c_preferred_cust_flag AS customer_preferred_cust_flag, customer4.c_birth_country AS customer_birth_country, customer4.c_login AS customer_login, customer4.c_email_address AS customer_email_address, date_dim4.d_year AS dyear, SUM((web_sales0.ws_ext_list_price - web_sales0.ws_ext_wholesale_cost - web_sales0.ws_ext_discount_amt + web_sales0.ws_ext_sales_price) / 2) AS year_total, 'w' AS sale_type FROM customer AS customer4 INNER JOIN web_sales AS web_sales0 ON customer4.c_customer_sk = web_sales0.ws_bill_customer_sk INNER JOIN date_dim AS date_dim4 ON web_sales0.ws_sold_date_sk = date_dim4.d_date_sk GROUP BY customer4.c_customer_id, customer4.c_first_name, customer4.c_last_name, customer4.c_preferred_cust_flag, customer4.c_birth_country, customer4.c_login, customer4.c_email_address, date_dim4.d_year) AS t19 WHERE sale_type = 's' AND dyear = 1999 + 1) AS t20 ON t9.customer_id = t20.customer_id INNER JOIN (SELECT * FROM (SELECT customer5.c_customer_id AS customer_id, customer5.c_first_name AS customer_first_name, customer5.c_last_name AS customer_last_name, customer5.c_preferred_cust_flag AS customer_preferred_cust_flag, customer5.c_birth_country AS customer_birth_country, customer5.c_login AS customer_login, customer5.c_email_address AS customer_email_address, date_dim5.d_year AS dyear, SUM((store_sales1.ss_ext_list_price - store_sales1.ss_ext_wholesale_cost - store_sales1.ss_ext_discount_amt + store_sales1.ss_ext_sales_price) / 2) AS year_total, 's' AS sale_type FROM customer AS customer5 INNER JOIN store_sales AS store_sales1 ON customer5.c_customer_sk = store_sales1.ss_customer_sk INNER JOIN date_dim AS date_dim5 ON store_sales1.ss_sold_date_sk = date_dim5.d_date_sk GROUP BY customer5.c_customer_id, customer5.c_first_name, customer5.c_last_name, customer5.c_preferred_cust_flag, customer5.c_birth_country, customer5.c_login, customer5.c_email_address, date_dim5.d_year UNION ALL SELECT customer6.c_customer_id AS customer_id, customer6.c_first_name AS customer_first_name, customer6.c_last_name AS customer_last_name, customer6.c_preferred_cust_flag AS customer_preferred_cust_flag, customer6.c_birth_country AS customer_birth_country, customer6.c_login AS customer_login, customer6.c_email_address AS customer_email_address, date_dim6.d_year AS dyear, SUM((catalog_sales1.cs_ext_list_price - catalog_sales1.cs_ext_wholesale_cost - catalog_sales1.cs_ext_discount_amt + catalog_sales1.cs_ext_sales_price) / 2) AS year_total, 'c' AS sale_type FROM customer AS customer6 INNER JOIN catalog_sales AS catalog_sales1 ON customer6.c_customer_sk = catalog_sales1.cs_bill_customer_sk INNER JOIN date_dim AS date_dim6 ON catalog_sales1.cs_sold_date_sk = date_dim6.d_date_sk GROUP BY customer6.c_customer_id, customer6.c_first_name, customer6.c_last_name, customer6.c_preferred_cust_flag, customer6.c_birth_country, customer6.c_login, customer6.c_email_address, date_dim6.d_year UNION ALL SELECT customer7.c_customer_id AS customer_id, customer7.c_first_name AS customer_first_name, customer7.c_last_name AS customer_last_name, customer7.c_preferred_cust_flag AS customer_preferred_cust_flag, customer7.c_birth_country AS customer_birth_country, customer7.c_login AS customer_login, customer7.c_email_address AS customer_email_address, date_dim7.d_year AS dyear, SUM((web_sales1.ws_ext_list_price - web_sales1.ws_ext_wholesale_cost - web_sales1.ws_ext_discount_amt + web_sales1.ws_ext_sales_price) / 2) AS year_total, 'w' AS sale_type FROM customer AS customer7 INNER JOIN web_sales AS web_sales1 ON customer7.c_customer_sk = web_sales1.ws_bill_customer_sk INNER JOIN date_dim AS date_dim7 ON web_sales1.ws_sold_date_sk = date_dim7.d_date_sk GROUP BY customer7.c_customer_id, customer7.c_first_name, customer7.c_last_name, customer7.c_preferred_cust_flag, customer7.c_birth_country, customer7.c_login, customer7.c_email_address, date_dim7.d_year) AS t30 WHERE sale_type = 'c' AND dyear = 1999 AND year_total > 0) AS t31 ON t9.customer_id = t31.customer_id INNER JOIN (SELECT * FROM (SELECT customer8.c_customer_id AS customer_id, customer8.c_first_name AS customer_first_name, customer8.c_last_name AS customer_last_name, customer8.c_preferred_cust_flag AS customer_preferred_cust_flag, customer8.c_birth_country AS customer_birth_country, customer8.c_login AS customer_login, customer8.c_email_address AS customer_email_address, date_dim8.d_year AS dyear, SUM((store_sales2.ss_ext_list_price - store_sales2.ss_ext_wholesale_cost - store_sales2.ss_ext_discount_amt + store_sales2.ss_ext_sales_price) / 2) AS year_total, 's' AS sale_type FROM customer AS customer8 INNER JOIN store_sales AS store_sales2 ON customer8.c_customer_sk = store_sales2.ss_customer_sk INNER JOIN date_dim AS date_dim8 ON store_sales2.ss_sold_date_sk = date_dim8.d_date_sk GROUP BY customer8.c_customer_id, customer8.c_first_name, customer8.c_last_name, customer8.c_preferred_cust_flag, customer8.c_birth_country, customer8.c_login, customer8.c_email_address, date_dim8.d_year UNION ALL SELECT customer9.c_customer_id AS customer_id, customer9.c_first_name AS customer_first_name, customer9.c_last_name AS customer_last_name, customer9.c_preferred_cust_flag AS customer_preferred_cust_flag, customer9.c_birth_country AS customer_birth_country, customer9.c_login AS customer_login, customer9.c_email_address AS customer_email_address, date_dim9.d_year AS dyear, SUM((catalog_sales2.cs_ext_list_price - catalog_sales2.cs_ext_wholesale_cost - catalog_sales2.cs_ext_discount_amt + catalog_sales2.cs_ext_sales_price) / 2) AS year_total, 'c' AS sale_type FROM customer AS customer9 INNER JOIN catalog_sales AS catalog_sales2 ON customer9.c_customer_sk = catalog_sales2.cs_bill_customer_sk INNER JOIN date_dim AS date_dim9 ON catalog_sales2.cs_sold_date_sk = date_dim9.d_date_sk GROUP BY customer9.c_customer_id, customer9.c_first_name, customer9.c_last_name, customer9.c_preferred_cust_flag, customer9.c_birth_country, customer9.c_login, customer9.c_email_address, date_dim9.d_year UNION ALL SELECT customer10.c_customer_id AS customer_id, customer10.c_first_name AS customer_first_name, customer10.c_last_name AS customer_last_name, customer10.c_preferred_cust_flag AS customer_preferred_cust_flag, customer10.c_birth_country AS customer_birth_country, customer10.c_login AS customer_login, customer10.c_email_address AS customer_email_address, date_dim10.d_year AS dyear, SUM((web_sales2.ws_ext_list_price - web_sales2.ws_ext_wholesale_cost - web_sales2.ws_ext_discount_amt + web_sales2.ws_ext_sales_price) / 2) AS year_total, 'w' AS sale_type FROM customer AS customer10 INNER JOIN web_sales AS web_sales2 ON customer10.c_customer_sk = web_sales2.ws_bill_customer_sk INNER JOIN date_dim AS date_dim10 ON web_sales2.ws_sold_date_sk = date_dim10.d_date_sk GROUP BY customer10.c_customer_id, customer10.c_first_name, customer10.c_last_name, customer10.c_preferred_cust_flag, customer10.c_birth_country, customer10.c_login, customer10.c_email_address, date_dim10.d_year) AS t41 WHERE sale_type = 'c' AND dyear = 1999 + 1) AS t42 ON t9.customer_id = t42.customer_id AND CASE WHEN t31.year_total > 0 THEN t42.year_total / t31.year_total ELSE NULL END > CASE WHEN t9.year_total > 0 THEN t20.year_total / t9.year_total ELSE NULL END INNER JOIN (SELECT * FROM (SELECT customer11.c_customer_id AS customer_id, customer11.c_first_name AS customer_first_name, customer11.c_last_name AS customer_last_name, customer11.c_preferred_cust_flag AS customer_preferred_cust_flag, customer11.c_birth_country AS customer_birth_country, customer11.c_login AS customer_login, customer11.c_email_address AS customer_email_address, date_dim11.d_year AS dyear, SUM((store_sales3.ss_ext_list_price - store_sales3.ss_ext_wholesale_cost - store_sales3.ss_ext_discount_amt + store_sales3.ss_ext_sales_price) / 2) AS year_total, 's' AS sale_type FROM customer AS customer11 INNER JOIN store_sales AS store_sales3 ON customer11.c_customer_sk = store_sales3.ss_customer_sk INNER JOIN date_dim AS date_dim11 ON store_sales3.ss_sold_date_sk = date_dim11.d_date_sk GROUP BY customer11.c_customer_id, customer11.c_first_name, customer11.c_last_name, customer11.c_preferred_cust_flag, customer11.c_birth_country, customer11.c_login, customer11.c_email_address, date_dim11.d_year UNION ALL SELECT customer12.c_customer_id AS customer_id, customer12.c_first_name AS customer_first_name, customer12.c_last_name AS customer_last_name, customer12.c_preferred_cust_flag AS customer_preferred_cust_flag, customer12.c_birth_country AS customer_birth_country, customer12.c_login AS customer_login, customer12.c_email_address AS customer_email_address, date_dim12.d_year AS dyear, SUM((catalog_sales3.cs_ext_list_price - catalog_sales3.cs_ext_wholesale_cost - catalog_sales3.cs_ext_discount_amt + catalog_sales3.cs_ext_sales_price) / 2) AS year_total, 'c' AS sale_type FROM customer AS customer12 INNER JOIN catalog_sales AS catalog_sales3 ON customer12.c_customer_sk = catalog_sales3.cs_bill_customer_sk INNER JOIN date_dim AS date_dim12 ON catalog_sales3.cs_sold_date_sk = date_dim12.d_date_sk GROUP BY customer12.c_customer_id, customer12.c_first_name, customer12.c_last_name, customer12.c_preferred_cust_flag, customer12.c_birth_country, customer12.c_login, customer12.c_email_address, date_dim12.d_year UNION ALL SELECT customer13.c_customer_id AS customer_id, customer13.c_first_name AS customer_first_name, customer13.c_last_name AS customer_last_name, customer13.c_preferred_cust_flag AS customer_preferred_cust_flag, customer13.c_birth_country AS customer_birth_country, customer13.c_login AS customer_login, customer13.c_email_address AS customer_email_address, date_dim13.d_year AS dyear, SUM((web_sales3.ws_ext_list_price - web_sales3.ws_ext_wholesale_cost - web_sales3.ws_ext_discount_amt + web_sales3.ws_ext_sales_price) / 2) AS year_total, 'w' AS sale_type FROM customer AS customer13 INNER JOIN web_sales AS web_sales3 ON customer13.c_customer_sk = web_sales3.ws_bill_customer_sk INNER JOIN date_dim AS date_dim13 ON web_sales3.ws_sold_date_sk = date_dim13.d_date_sk GROUP BY customer13.c_customer_id, customer13.c_first_name, customer13.c_last_name, customer13.c_preferred_cust_flag, customer13.c_birth_country, customer13.c_login, customer13.c_email_address, date_dim13.d_year) AS t52 WHERE sale_type = 'w' AND dyear = 1999 AND year_total > 0) AS t53 ON t9.customer_id = t53.customer_id INNER JOIN (SELECT * FROM (SELECT customer14.c_customer_id AS customer_id, customer14.c_first_name AS customer_first_name, customer14.c_last_name AS customer_last_name, customer14.c_preferred_cust_flag AS customer_preferred_cust_flag, customer14.c_birth_country AS customer_birth_country, customer14.c_login AS customer_login, customer14.c_email_address AS customer_email_address, date_dim14.d_year AS dyear, SUM((store_sales4.ss_ext_list_price - store_sales4.ss_ext_wholesale_cost - store_sales4.ss_ext_discount_amt + store_sales4.ss_ext_sales_price) / 2) AS year_total, 's' AS sale_type FROM customer AS customer14 INNER JOIN store_sales AS store_sales4 ON customer14.c_customer_sk = store_sales4.ss_customer_sk INNER JOIN date_dim AS date_dim14 ON store_sales4.ss_sold_date_sk = date_dim14.d_date_sk GROUP BY customer14.c_customer_id, customer14.c_first_name, customer14.c_last_name, customer14.c_preferred_cust_flag, customer14.c_birth_country, customer14.c_login, customer14.c_email_address, date_dim14.d_year UNION ALL SELECT customer15.c_customer_id AS customer_id, customer15.c_first_name AS customer_first_name, customer15.c_last_name AS customer_last_name, customer15.c_preferred_cust_flag AS customer_preferred_cust_flag, customer15.c_birth_country AS customer_birth_country, customer15.c_login AS customer_login, customer15.c_email_address AS customer_email_address, date_dim15.d_year AS dyear, SUM((catalog_sales4.cs_ext_list_price - catalog_sales4.cs_ext_wholesale_cost - catalog_sales4.cs_ext_discount_amt + catalog_sales4.cs_ext_sales_price) / 2) AS year_total, 'c' AS sale_type FROM customer AS customer15 INNER JOIN catalog_sales AS catalog_sales4 ON customer15.c_customer_sk = catalog_sales4.cs_bill_customer_sk INNER JOIN date_dim AS date_dim15 ON catalog_sales4.cs_sold_date_sk = date_dim15.d_date_sk GROUP BY customer15.c_customer_id, customer15.c_first_name, customer15.c_last_name, customer15.c_preferred_cust_flag, customer15.c_birth_country, customer15.c_login, customer15.c_email_address, date_dim15.d_year UNION ALL SELECT customer16.c_customer_id AS customer_id, customer16.c_first_name AS customer_first_name, customer16.c_last_name AS customer_last_name, customer16.c_preferred_cust_flag AS customer_preferred_cust_flag, customer16.c_birth_country AS customer_birth_country, customer16.c_login AS customer_login, customer16.c_email_address AS customer_email_address, date_dim16.d_year AS dyear, SUM((web_sales4.ws_ext_list_price - web_sales4.ws_ext_wholesale_cost - web_sales4.ws_ext_discount_amt + web_sales4.ws_ext_sales_price) / 2) AS year_total, 'w' AS sale_type FROM customer AS customer16 INNER JOIN web_sales AS web_sales4 ON customer16.c_customer_sk = web_sales4.ws_bill_customer_sk INNER JOIN date_dim AS date_dim16 ON web_sales4.ws_sold_date_sk = date_dim16.d_date_sk GROUP BY customer16.c_customer_id, customer16.c_first_name, customer16.c_last_name, customer16.c_preferred_cust_flag, customer16.c_birth_country, customer16.c_login, customer16.c_email_address, date_dim16.d_year) AS t63 WHERE sale_type = 'w' AND dyear = 1999 + 1) AS t64 ON t9.customer_id = t64.customer_id AND CASE WHEN t31.year_total > 0 THEN CAST(t42.year_total / t31.year_total AS DECIMAL(19, 0)) ELSE NULL END > CASE WHEN t53.year_total > 0 THEN CAST(t64.year_total / t53.year_total AS DECIMAL(19, 0)) ELSE NULL END ORDER BY t20.customer_id, t20.customer_first_name, t20.customer_last_name, t20.customer_birth_country LIMIT 100
Perform window ranking after aggregation: Ensures ranks are computed on a reduced dataset, improving performance.
Break aggregated data by period: Splitting the overall aggregation into separate subqueries for each period minimizes self-joins and simplifies comparisons.
Push filtering conditions into each CTE: Reduces the number of rows processed in later aggregations.
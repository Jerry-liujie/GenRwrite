Extract common filtering logic into a separate derived table: Reduces duplicate computation and simplifies maintenance.
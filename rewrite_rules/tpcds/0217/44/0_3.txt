Move filtering conditions (such as rank limits) to the outer query: enables the optimizer to apply them after the set is materialized, reducing unnecessary work.